<!doctype html>

<head>
  <!-- <base
    href="https://api.cashflowcasino.com/games/nolimit"
    target="_blank"
  /> -->
  <meta charset="utf-8" />
  <title>Cashcow | Casino</title>
  <script src="https://unpkg.com/axios@1.6.7/dist/axios.min.js"></script>
</head>

<body>
  <div id="addon"></div>
  <script></script>
  <script src="./nolimit/nolimit-latest.min.js" nonce="MTMwODM2NzkyMywyMzk0MDIzMjI1"></script>
  <script nonce="MTMwODM2NzkyMywyMzk0MDIzMjI1"></script>
  <script></script>
  <script type="module" nonce="MTMwODM2NzkyMywyMzk0MDIzMjI1">
    // const queryString = window.location.search;
    // const urlParams = new URLSearchParams(queryString);
    // let gameName = urlParams.get("gameName");
    // gameName = gameName.replace("NLC", "");
    // console.log(urlParams)
    // const token = urlParams.get("token");

    // document.cookie = `token=${token}  SameSite=None; Secure`;
    // if(token.length < 10) return
    // const instance = axios.create({
    //   timeout: 1000,
    //   headers: {
    //     authorization: `Bearer ${token}`,
    //     // gamedata: `${gameId} ${gameName}`,
    //   },
    // });
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    let gameName = urlParams.get('gameName');
    // gameName = gameName.replace("NLC", "");
    // console.log(gameName)
    const token = urlParams.get('token');
    // console.log(token)
    // var apiKey = "nfET_A.QjvYvA:FPKPdLUkzdvRZHNc";
    // var url =
    //   `https://realtime.ably.io/event-stream?channels=${token}&v=1.2&key=` +
    //   apiKey;
    // var eventSource = new EventSource(url);

    // eventSource.onmessage = function (event) {
    //   var message = JSON.parse(event.data);
    //   console.log("Message: " + message.name + " - " + message.data);
    // };
    document.cookie = `token=${token}  SameSite=None; Secure`;
    // if (token.length < 10)
    // window.location.href = "http://test.cashflowcasino.com/";
    const instance = axios.create({
      timeout: 1000,
      headers: {
        authorization: `Bearer ${token}`,
        // gamedata: `${gameId} ${gameName}`,
      },
    });

    if (gameName !== undefined) {
      window.axios = instance;
      window.gameName = gameName;
      window.token = token;
    }
    if (gameName !== undefined) {
      // window.axios = instance;
      // window.gameName = gameName;
      // window.token = token;

      var options = {};
      options.game = window.gameName;
      console.log(options.game);

      options.device = options.device || 'mobile';
      var extra = '';
      var data = {
        operator: 'HOMEPAGE_PUBLIC',
        environment: 'demo',
        game: options.game,
        device: options.device,
        extra: extra,
        autoplay: false,
        hideCurrency: true,
        playForFunCurrency: 'USD',
        hideExitButton: true,
        useReplayLinkPopup: true,
        googleAnalytics: false,
        lobbyUrl: `https://test.cashflowcasino.com#/games/nolimit?gameName=${gameName}NLC&developer=nolimit&token=${window.token}`,
        depositUrl: `https://test.cashflowcasino.com#/games/nolimit?gameName=${gameName}NLC&developer=nolimit&token=${window.token}`,
        supportUrl: `https://test.cashflowcasino.com#/games/nolimit?gameName=${gameName}NLC&developer=nolimit&token=${window.token}`,
        depositEvent: false,
        lobbyEvent: false,
        accountHistoryUrl: '/game/account-history',
        realityCheck: {
          enabled: false,
        },
        quality: 'high',
      };

      if (options.token) {
        data.token = options.token;
        data.demo = options.demo;
      }
      var api = nolimit.load(data);
      // api.axios = window.axios;
      api.on('exit', function () {
        if (sessionStorage.getItem('demo.username') != null) {
          parent.location.href = `https://test.cashflowcasino.com#/games/nolimit?gameName=${gameName}NLC&developer=nolimit&token=${window.token}`;
        } else {
          parent.location.href = `https://test.cashflowcasino.com#/games/nolimit?gameName=${gameName}NLC&developer=nolimit&token=${window.token}`;
        }
      });

      api.on('ready', function () {
        console.log(options.game, options.device, 'is loaded');
        const iframes = document.querySelectorAll('iframe');
        // iframes[0].contentWindow.axios = window.axios;
        // iframes[0].contentWindow.token = window.token;
        const tbl = window.document.querySelector('top-bar-left');
        // window.parent.postMessage(JSON.stringify({ event: "ready" }), "*");
        window.parent.postMessage(JSON.stringify({ event: 'ready', data: 'ready' }), '*');
        // window.postMessage(
        //   JSON.stringify({ event: "ready", data: "ready" }),
        //   "*"
        // );
      });
      api.on('*', function (x) {
        console.log('some message');
        window.parent.postMessage(JSON.stringify({ event: 'message' }), '*');
      });
      api.on('message', function (x) {
        console.log('some messagex');
        window.parent.postMessage(JSON.stringify({ event: 'message' }), '*');
      });
      api.on('balance', function updateBalance(balance) {
        console.log('some balance', balance);
        window.parent.postMessage(JSON.stringify({ event: 'balance', data: balance }), '*');
        window.postMessage(JSON.stringify({ event: 'balance', data: balance }), '*');
      });
    }
  </script>

  <script defer="">
    window.addEventListener('message', function (e) {
      console.log(e); // busy, idle, ready
    });
    window.addEventListener('deposit', function (e) {
      console.log(e); // busy, idle, ready
    });

    window.addEventListener('events', function (e) {
      console.log(e); // busy, idle, ready
    });
  </script>
</body>
